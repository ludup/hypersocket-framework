<div id="contentMessages">
	<input type="hidden" id="resourceId" name="resourceId" value="" />
	<input type="hidden" id="resourceName" name="resourceName" value="" />
</div>

<script type="text/javascript">
	legacyjQueryReadyFix(function() {
		
				if(!$('#addMessageForm').length) {
					$('#contentMessages').append('<div  id="addMessageForm" dialog-for="contentMessages"><div id="messageProperties"></div></div>');
				}
				
				$('#contentMessages').localize();
				$('#contentMessages').ajaxResourcePage(
						{
							id : "Message",
							tableUrl : "messages/table",
							title: getResource("messages.label"),
							icon: 'fa-envelope-o',
							infoHtml: getResource('messages.infoHtml'),
							resourceUrl : "messages/message",
							deleteResourcesUrl : "messages/bulk",
							fields : [ {
								name : "name"
							}, {
								name: "enabled",
								formatter: function(value, obj, idx) {
									return value ? getResource('text.yes') : getResource('text.no');
								}
							}, {
								name: 'info',
								formatter: function(value, obj, idx) {
									
									return getResourceOrDefault('messageText.' + obj.messageId, '');
								}
							}],
							resourceKey : "message",
							canCreate: currentMenu.canCreate,
							canCopy: false,
							resourceView: 'samePage',
							canUpdate: currentMenu.canUpdate,
							canDelete: currentMenu.canDelete,
							checkbox : true,
							validate : function() {

								if ($('#resourceName').val() == '') {
									showError("error.nameRequired");
									return false;
								}

								if(!$('#messageProperties').validateProperties()) {
									showError("error.correctValidationErrors");
									return false;
								}
								
								return true;
							},
							clearDialog : function(create) {
								
								$('#resourceId').val('');
								$('#resourceName').val('');

							},
							createResource : function() {
								resource = new Object();
								resource.id = $('#resourceId').val();
								resource.name = $('#resourceName').val();
								
								$('#messageProperties').saveProperties(true,
										function(items) {
											resource.properties = items;
								});
								
								return resource;
							},
							displayResource : function(resource, readOnly) {
								
								$('#resourceId').val(resource.id);
								$('#resourceName').val(resource.name);
							
							},
							propertyOptions: { 
								propertySelector : '#messageProperties',
								templateUrl : 'messages/template/', 
								propertiesUrl: 'messages/properties/',
								showButtons : false, 
								showAdditionalTabButtons: false,
								maintainButtonState: false,
								i18nNamespace: 'message',
								canUpdate : currentMenu.canUpdate,
								useTemplates : true
							},
							complete : function() {
								loadComplete();
							}
						});

			});
</script>